{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/ridmashehan/vinulab%20web/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nconst url = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (typeof window === \"undefined\" && (!url || !serviceKey) && process.env.NODE_ENV === \"development\") {\n  console.warn(\n    \"[vinulab] Supabase not configured. Using file fallback for content/consultations/analytics. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY in .env.local to use the database.\"\n  );\n}\n\nexport const supabase =\n  url && serviceKey ? createClient(url, serviceKey, { auth: { persistSession: false } }) : null;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,wBAAwB;AAChD,MAAM,aAAa,QAAQ,GAAG,CAAC,yBAAyB;AAExD,IAAI,kDAAkB,eAAe,CAAC,CAAC,OAAO,CAAC,UAAU,KAAK,oDAAyB,eAAe;IACpG,QAAQ,IAAI,CACV;AAEJ;AAEO,MAAM,WACX,OAAO,aAAa,IAAA,gMAAY,EAAC,KAAK,YAAY;IAAE,MAAM;QAAE,gBAAgB;IAAM;AAAE,KAAK"}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///Users/ridmashehan/vinulab%20web/src/lib/analytics.ts"],"sourcesContent":["import path from \"path\";\nimport fs from \"fs\";\nimport { supabase } from \"./supabase\";\n\nexport interface VisitRecord {\n  id: string;\n  timestamp: number;\n  path: string;\n  ip: string;\n  country?: string;\n  region?: string;\n  city?: string;\n  ll?: [number, number];\n  userAgent?: string;\n  referrer?: string;\n  screenWidth?: number;\n  screenHeight?: number;\n}\n\nconst analyticsPath = () => path.join(process.cwd(), \"src\", \"data\", \"analytics.json\");\n\nfunction getAnalyticsFromFile(): VisitRecord[] {\n  try {\n    const raw = fs.readFileSync(analyticsPath(), \"utf-8\");\n    return JSON.parse(raw) as VisitRecord[];\n  } catch {\n    return [];\n  }\n}\n\nexport async function getAnalytics(): Promise<VisitRecord[]> {\n  if (supabase) {\n    const { data, error } = await supabase\n      .from(\"analytics_visits\")\n      .select(\"*\")\n      .order(\"timestamp\", { ascending: false });\n    if (!error && data) {\n      return data.map((r) => ({\n        id: r.id,\n        timestamp: r.timestamp,\n        path: r.path,\n        ip: r.ip,\n        country: r.country,\n        region: r.region,\n        city: r.city,\n        ll: r.ll as [number, number] | undefined,\n        userAgent: r.user_agent,\n        referrer: r.referrer,\n        screenWidth: r.screen_width,\n        screenHeight: r.screen_height,\n      }));\n    }\n  }\n  return getAnalyticsFromFile();\n}\n\nexport async function appendVisit(record: VisitRecord): Promise<void> {\n  if (supabase) {\n    const { error } = await supabase.from(\"analytics_visits\").insert({\n      id: record.id,\n      timestamp: record.timestamp,\n      path: record.path,\n      ip: record.ip,\n      country: record.country,\n      region: record.region,\n      city: record.city,\n      ll: record.ll,\n      user_agent: record.userAgent,\n      referrer: record.referrer,\n      screen_width: record.screenWidth,\n      screen_height: record.screenHeight,\n    });\n    if (error) throw new Error(error.message);\n    return;\n  }\n  const data = getAnalyticsFromFile();\n  data.push(record);\n  fs.writeFileSync(analyticsPath(), JSON.stringify(data, null, 2), \"utf-8\");\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAiBA,MAAM,gBAAgB,IAAM,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,OAAO,QAAQ;AAEpE,SAAS;IACP,IAAI;QACF,MAAM,MAAM,wGAAE,CAAC,YAAY,CAAC,iBAAiB;QAC7C,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,OAAO,EAAE;IACX;AACF;AAEO,eAAe;IACpB,IAAI,oIAAQ,EAAE;QACZ,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,oIAAQ,CACnC,IAAI,CAAC,oBACL,MAAM,CAAC,KACP,KAAK,CAAC,aAAa;YAAE,WAAW;QAAM;QACzC,IAAI,CAAC,SAAS,MAAM;YAClB,OAAO,KAAK,GAAG,CAAC,CAAC,IAAM,CAAC;oBACtB,IAAI,EAAE,EAAE;oBACR,WAAW,EAAE,SAAS;oBACtB,MAAM,EAAE,IAAI;oBACZ,IAAI,EAAE,EAAE;oBACR,SAAS,EAAE,OAAO;oBAClB,QAAQ,EAAE,MAAM;oBAChB,MAAM,EAAE,IAAI;oBACZ,IAAI,EAAE,EAAE;oBACR,WAAW,EAAE,UAAU;oBACvB,UAAU,EAAE,QAAQ;oBACpB,aAAa,EAAE,YAAY;oBAC3B,cAAc,EAAE,aAAa;gBAC/B,CAAC;QACH;IACF;IACA,OAAO;AACT;AAEO,eAAe,YAAY,MAAmB;IACnD,IAAI,oIAAQ,EAAE;QACZ,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,oIAAQ,CAAC,IAAI,CAAC,oBAAoB,MAAM,CAAC;YAC/D,IAAI,OAAO,EAAE;YACb,WAAW,OAAO,SAAS;YAC3B,MAAM,OAAO,IAAI;YACjB,IAAI,OAAO,EAAE;YACb,SAAS,OAAO,OAAO;YACvB,QAAQ,OAAO,MAAM;YACrB,MAAM,OAAO,IAAI;YACjB,IAAI,OAAO,EAAE;YACb,YAAY,OAAO,SAAS;YAC5B,UAAU,OAAO,QAAQ;YACzB,cAAc,OAAO,WAAW;YAChC,eAAe,OAAO,YAAY;QACpC;QACA,IAAI,OAAO,MAAM,IAAI,MAAM,MAAM,OAAO;QACxC;IACF;IACA,MAAM,OAAO;IACb,KAAK,IAAI,CAAC;IACV,wGAAE,CAAC,aAAa,CAAC,iBAAiB,KAAK,SAAS,CAAC,MAAM,MAAM,IAAI;AACnE"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///Users/ridmashehan/vinulab%20web/src/app/api/analytics/track/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { appendVisit, type VisitRecord } from \"@/lib/analytics\";\n\nfunction getClientIp(req: NextRequest): string {\n  const forwarded = req.headers.get(\"x-forwarded-for\");\n  if (forwarded) return forwarded.split(\",\")[0].trim();\n  const realIp = req.headers.get(\"x-real-ip\");\n  if (realIp) return realIp;\n  return \"127.0.0.1\";\n}\n\nasync function getGeo(ip: string): Promise<{ country?: string; region?: string; city?: string; ll?: [number, number] }> {\n  if (ip === \"127.0.0.1\" || ip === \"::1\" || ip.startsWith(\"192.168.\") || ip.startsWith(\"10.\")) {\n    return {};\n  }\n  try {\n    const res = await fetch(`http://ip-api.com/json/${ip}?fields=country,regionName,city,lat,lon`, {\n      signal: AbortSignal.timeout(3000),\n    });\n    const data = (await res.json()) as { country?: string; regionName?: string; city?: string; lat?: number; lon?: number };\n    if (data.lat != null && data.lon != null) {\n      return {\n        country: data.country,\n        region: data.regionName,\n        city: data.city,\n        ll: [data.lon, data.lat] as [number, number],\n      };\n    }\n  } catch {\n    // ignore\n  }\n  return {};\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const ip = getClientIp(request);\n    const body = await request.json().catch(() => ({}));\n    const { path: pagePath = \"/\", referrer, userAgent, screenWidth, screenHeight } = body;\n\n    const geo = await getGeo(ip);\n    const record: VisitRecord = {\n      id: `${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\n      timestamp: Date.now(),\n      path: String(pagePath).slice(0, 256),\n      ip,\n      country: geo.country,\n      region: geo.region,\n      city: geo.city,\n      ll: geo.ll,\n      userAgent: userAgent ? String(userAgent).slice(0, 512) : request.headers.get(\"user-agent\") ?? undefined,\n      referrer: referrer ? String(referrer).slice(0, 512) : undefined,\n      screenWidth: typeof screenWidth === \"number\" ? screenWidth : undefined,\n      screenHeight: typeof screenHeight === \"number\" ? screenHeight : undefined,\n    };\n\n    await appendVisit(record);\n    return NextResponse.json({ ok: true });\n  } catch (err) {\n    console.error(\"Analytics track error:\", err);\n    return NextResponse.json({ error: \"Track failed\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,SAAS,YAAY,GAAgB;IACnC,MAAM,YAAY,IAAI,OAAO,CAAC,GAAG,CAAC;IAClC,IAAI,WAAW,OAAO,UAAU,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI;IAClD,MAAM,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC;IAC/B,IAAI,QAAQ,OAAO;IACnB,OAAO;AACT;AAEA,eAAe,OAAO,EAAU;IAC9B,IAAI,OAAO,eAAe,OAAO,SAAS,GAAG,UAAU,CAAC,eAAe,GAAG,UAAU,CAAC,QAAQ;QAC3F,OAAO,CAAC;IACV;IACA,IAAI;QACF,MAAM,MAAM,MAAM,MAAM,CAAC,uBAAuB,EAAE,GAAG,uCAAuC,CAAC,EAAE;YAC7F,QAAQ,YAAY,OAAO,CAAC;QAC9B;QACA,MAAM,OAAQ,MAAM,IAAI,IAAI;QAC5B,IAAI,KAAK,GAAG,IAAI,QAAQ,KAAK,GAAG,IAAI,MAAM;YACxC,OAAO;gBACL,SAAS,KAAK,OAAO;gBACrB,QAAQ,KAAK,UAAU;gBACvB,MAAM,KAAK,IAAI;gBACf,IAAI;oBAAC,KAAK,GAAG;oBAAE,KAAK,GAAG;iBAAC;YAC1B;QACF;IACF,EAAE,OAAM;IACN,SAAS;IACX;IACA,OAAO,CAAC;AACV;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,KAAK,YAAY;QACvB,MAAM,OAAO,MAAM,QAAQ,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QACjD,MAAM,EAAE,MAAM,WAAW,GAAG,EAAE,QAAQ,EAAE,SAAS,EAAE,WAAW,EAAE,YAAY,EAAE,GAAG;QAEjF,MAAM,MAAM,MAAM,OAAO;QACzB,MAAM,SAAsB;YAC1B,IAAI,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,IAAI;YAC7D,WAAW,KAAK,GAAG;YACnB,MAAM,OAAO,UAAU,KAAK,CAAC,GAAG;YAChC;YACA,SAAS,IAAI,OAAO;YACpB,QAAQ,IAAI,MAAM;YAClB,MAAM,IAAI,IAAI;YACd,IAAI,IAAI,EAAE;YACV,WAAW,YAAY,OAAO,WAAW,KAAK,CAAC,GAAG,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,iBAAiB;YAC9F,UAAU,WAAW,OAAO,UAAU,KAAK,CAAC,GAAG,OAAO;YACtD,aAAa,OAAO,gBAAgB,WAAW,cAAc;YAC7D,cAAc,OAAO,iBAAiB,WAAW,eAAe;QAClE;QAEA,MAAM,IAAA,wIAAW,EAAC;QAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;QAAK;IACtC,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF"}}]
}
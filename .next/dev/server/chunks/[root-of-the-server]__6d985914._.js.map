{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/ridmashehan/vinulab%20web/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nconst url = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (typeof window === \"undefined\" && (!url || !serviceKey) && process.env.NODE_ENV === \"development\") {\n  console.warn(\n    \"[vinulab] Supabase not configured. Using file fallback for content/consultations/analytics. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY in .env.local to use the database.\"\n  );\n}\n\nexport const supabase =\n  url && serviceKey ? createClient(url, serviceKey, { auth: { persistSession: false } }) : null;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,wBAAwB;AAChD,MAAM,aAAa,QAAQ,GAAG,CAAC,yBAAyB;AAExD,IAAI,kDAAkB,eAAe,CAAC,CAAC,OAAO,CAAC,UAAU,KAAK,oDAAyB,eAAe;IACpG,QAAQ,IAAI,CACV;AAEJ;AAEO,MAAM,WACX,OAAO,aAAa,IAAA,gMAAY,EAAC,KAAK,YAAY;IAAE,MAAM;QAAE,gBAAgB;IAAM;AAAE,KAAK"}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///Users/ridmashehan/vinulab%20web/src/lib/analytics.ts"],"sourcesContent":["import path from \"path\";\nimport fs from \"fs\";\nimport { supabase } from \"./supabase\";\n\nexport interface VisitRecord {\n  id: string;\n  timestamp: number;\n  path: string;\n  ip: string;\n  country?: string;\n  region?: string;\n  city?: string;\n  ll?: [number, number];\n  userAgent?: string;\n  referrer?: string;\n  screenWidth?: number;\n  screenHeight?: number;\n}\n\nconst analyticsPath = () => path.join(process.cwd(), \"src\", \"data\", \"analytics.json\");\n\nfunction getAnalyticsFromFile(): VisitRecord[] {\n  try {\n    const raw = fs.readFileSync(analyticsPath(), \"utf-8\");\n    return JSON.parse(raw) as VisitRecord[];\n  } catch {\n    return [];\n  }\n}\n\nexport async function getAnalytics(): Promise<VisitRecord[]> {\n  if (supabase) {\n    const { data, error } = await supabase\n      .from(\"analytics_visits\")\n      .select(\"*\")\n      .order(\"timestamp\", { ascending: false });\n    if (!error && data) {\n      return data.map((r) => ({\n        id: r.id,\n        timestamp: r.timestamp,\n        path: r.path,\n        ip: r.ip,\n        country: r.country,\n        region: r.region,\n        city: r.city,\n        ll: r.ll as [number, number] | undefined,\n        userAgent: r.user_agent,\n        referrer: r.referrer,\n        screenWidth: r.screen_width,\n        screenHeight: r.screen_height,\n      }));\n    }\n  }\n  return getAnalyticsFromFile();\n}\n\nexport async function appendVisit(record: VisitRecord): Promise<void> {\n  if (supabase) {\n    const { error } = await supabase.from(\"analytics_visits\").insert({\n      id: record.id,\n      timestamp: record.timestamp,\n      path: record.path,\n      ip: record.ip,\n      country: record.country,\n      region: record.region,\n      city: record.city,\n      ll: record.ll,\n      user_agent: record.userAgent,\n      referrer: record.referrer,\n      screen_width: record.screenWidth,\n      screen_height: record.screenHeight,\n    });\n    if (error) throw new Error(error.message);\n    return;\n  }\n  const data = getAnalyticsFromFile();\n  data.push(record);\n  fs.writeFileSync(analyticsPath(), JSON.stringify(data, null, 2), \"utf-8\");\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAiBA,MAAM,gBAAgB,IAAM,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,OAAO,QAAQ;AAEpE,SAAS;IACP,IAAI;QACF,MAAM,MAAM,wGAAE,CAAC,YAAY,CAAC,iBAAiB;QAC7C,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,OAAO,EAAE;IACX;AACF;AAEO,eAAe;IACpB,IAAI,oIAAQ,EAAE;QACZ,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,oIAAQ,CACnC,IAAI,CAAC,oBACL,MAAM,CAAC,KACP,KAAK,CAAC,aAAa;YAAE,WAAW;QAAM;QACzC,IAAI,CAAC,SAAS,MAAM;YAClB,OAAO,KAAK,GAAG,CAAC,CAAC,IAAM,CAAC;oBACtB,IAAI,EAAE,EAAE;oBACR,WAAW,EAAE,SAAS;oBACtB,MAAM,EAAE,IAAI;oBACZ,IAAI,EAAE,EAAE;oBACR,SAAS,EAAE,OAAO;oBAClB,QAAQ,EAAE,MAAM;oBAChB,MAAM,EAAE,IAAI;oBACZ,IAAI,EAAE,EAAE;oBACR,WAAW,EAAE,UAAU;oBACvB,UAAU,EAAE,QAAQ;oBACpB,aAAa,EAAE,YAAY;oBAC3B,cAAc,EAAE,aAAa;gBAC/B,CAAC;QACH;IACF;IACA,OAAO;AACT;AAEO,eAAe,YAAY,MAAmB;IACnD,IAAI,oIAAQ,EAAE;QACZ,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,oIAAQ,CAAC,IAAI,CAAC,oBAAoB,MAAM,CAAC;YAC/D,IAAI,OAAO,EAAE;YACb,WAAW,OAAO,SAAS;YAC3B,MAAM,OAAO,IAAI;YACjB,IAAI,OAAO,EAAE;YACb,SAAS,OAAO,OAAO;YACvB,QAAQ,OAAO,MAAM;YACrB,MAAM,OAAO,IAAI;YACjB,IAAI,OAAO,EAAE;YACb,YAAY,OAAO,SAAS;YAC5B,UAAU,OAAO,QAAQ;YACzB,cAAc,OAAO,WAAW;YAChC,eAAe,OAAO,YAAY;QACpC;QACA,IAAI,OAAO,MAAM,IAAI,MAAM,MAAM,OAAO;QACxC;IACF;IACA,MAAM,OAAO;IACb,KAAK,IAAI,CAAC;IACV,wGAAE,CAAC,aAAa,CAAC,iBAAiB,KAAK,SAAS,CAAC,MAAM,MAAM,IAAI;AACnE"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///Users/ridmashehan/vinulab%20web/src/app/api/analytics/stats/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { getAnalytics } from \"@/lib/analytics\";\n\nexport async function GET(request: NextRequest) {\n  try {\n    const password = request.headers.get(\"x-admin-password\");\n    const expected = process.env.ADMIN_PASSWORD || \"vinulab-admin\";\n    if (password !== expected) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const visits = await getAnalytics();\n\n    const uniqueIps = new Set(visits.map((v) => v.ip));\n    const byCountry: Record<string, number> = {};\n    const byPath: Record<string, number> = {};\n    const withLocation: { ll: [number, number]; country?: string; city?: string; count: number }[] = [];\n    const locationMap = new Map<string, { ll: [number, number]; country?: string; city?: string; count: number }>();\n\n    for (const v of visits) {\n      byPath[v.path] = (byPath[v.path] ?? 0) + 1;\n      if (v.country) byCountry[v.country] = (byCountry[v.country] ?? 0) + 1;\n\n      if (v.ll) {\n        const key = `${v.ll[0].toFixed(2)},${v.ll[1].toFixed(2)}`;\n        const existing = locationMap.get(key);\n        if (existing) existing.count++;\n        else locationMap.set(key, { ll: v.ll, country: v.country, city: v.city, count: 1 });\n      }\n    }\n\n    withLocation.push(...locationMap.values());\n\n    const last24h = Date.now() - 24 * 60 * 60 * 1000;\n    const last7d = Date.now() - 7 * 24 * 60 * 60 * 1000;\n    const visitsLast24h = visits.filter((v) => v.timestamp >= last24h).length;\n    const visitsLast7d = visits.filter((v) => v.timestamp >= last7d).length;\n\n    return NextResponse.json({\n      totalVisits: visits.length,\n      uniqueVisitors: uniqueIps.size,\n      visitsLast24h,\n      visitsLast7d,\n      byCountry: Object.entries(byCountry)\n        .sort((a, b) => b[1] - a[1])\n        .map(([country, count]) => ({ country, count })),\n      byPath: Object.entries(byPath)\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, 20),\n      locations: withLocation,\n      recentVisits: visits.slice(-100).reverse(),\n    });\n  } catch (err) {\n    console.error(\"Analytics stats error:\", err);\n    return NextResponse.json({ error: \"Failed to load analytics\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,WAAW,QAAQ,OAAO,CAAC,GAAG,CAAC;QACrC,MAAM,WAAW,QAAQ,GAAG,CAAC,cAAc,IAAI;QAC/C,IAAI,aAAa,UAAU;YACzB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,SAAS,MAAM,IAAA,yIAAY;QAEjC,MAAM,YAAY,IAAI,IAAI,OAAO,GAAG,CAAC,CAAC,IAAM,EAAE,EAAE;QAChD,MAAM,YAAoC,CAAC;QAC3C,MAAM,SAAiC,CAAC;QACxC,MAAM,eAA2F,EAAE;QACnG,MAAM,cAAc,IAAI;QAExB,KAAK,MAAM,KAAK,OAAQ;YACtB,MAAM,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI;YACzC,IAAI,EAAE,OAAO,EAAE,SAAS,CAAC,EAAE,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,OAAO,CAAC,IAAI,CAAC,IAAI;YAEpE,IAAI,EAAE,EAAE,EAAE;gBACR,MAAM,MAAM,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI;gBACzD,MAAM,WAAW,YAAY,GAAG,CAAC;gBACjC,IAAI,UAAU,SAAS,KAAK;qBACvB,YAAY,GAAG,CAAC,KAAK;oBAAE,IAAI,EAAE,EAAE;oBAAE,SAAS,EAAE,OAAO;oBAAE,MAAM,EAAE,IAAI;oBAAE,OAAO;gBAAE;YACnF;QACF;QAEA,aAAa,IAAI,IAAI,YAAY,MAAM;QAEvC,MAAM,UAAU,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK;QAC5C,MAAM,SAAS,KAAK,GAAG,KAAK,IAAI,KAAK,KAAK,KAAK;QAC/C,MAAM,gBAAgB,OAAO,MAAM,CAAC,CAAC,IAAM,EAAE,SAAS,IAAI,SAAS,MAAM;QACzE,MAAM,eAAe,OAAO,MAAM,CAAC,CAAC,IAAM,EAAE,SAAS,IAAI,QAAQ,MAAM;QAEvE,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,aAAa,OAAO,MAAM;YAC1B,gBAAgB,UAAU,IAAI;YAC9B;YACA;YACA,WAAW,OAAO,OAAO,CAAC,WACvB,IAAI,CAAC,CAAC,GAAG,IAAM,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,EAC1B,GAAG,CAAC,CAAC,CAAC,SAAS,MAAM,GAAK,CAAC;oBAAE;oBAAS;gBAAM,CAAC;YAChD,QAAQ,OAAO,OAAO,CAAC,QACpB,IAAI,CAAC,CAAC,GAAG,IAAM,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,EAC1B,KAAK,CAAC,GAAG;YACZ,WAAW;YACX,cAAc,OAAO,KAAK,CAAC,CAAC,KAAK,OAAO;QAC1C;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAChF;AACF"}}]
}
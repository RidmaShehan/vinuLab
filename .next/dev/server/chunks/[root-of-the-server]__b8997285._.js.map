{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/ridmashehan/vinulab%20web/src/lib/analytics.ts"],"sourcesContent":["import path from \"path\";\nimport fs from \"fs\";\n\nexport interface VisitRecord {\n  id: string;\n  timestamp: number;\n  path: string;\n  ip: string;\n  country?: string;\n  region?: string;\n  city?: string;\n  ll?: [number, number]; // [lon, lat]\n  userAgent?: string;\n  referrer?: string;\n  screenWidth?: number;\n  screenHeight?: number;\n}\n\nconst getFilePath = () => path.join(process.cwd(), \"src\", \"data\", \"analytics.json\");\n\nexport function getAnalytics(): VisitRecord[] {\n  try {\n    const raw = fs.readFileSync(getFilePath(), \"utf-8\");\n    return JSON.parse(raw);\n  } catch {\n    return [];\n  }\n}\n\nexport function appendVisit(record: VisitRecord): void {\n  const data = getAnalytics();\n  data.push(record);\n  fs.writeFileSync(getFilePath(), JSON.stringify(data, null, 2), \"utf-8\");\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAiBA,MAAM,cAAc,IAAM,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,OAAO,QAAQ;AAE3D,SAAS;IACd,IAAI;QACF,MAAM,MAAM,wGAAE,CAAC,YAAY,CAAC,eAAe;QAC3C,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,OAAO,EAAE;IACX;AACF;AAEO,SAAS,YAAY,MAAmB;IAC7C,MAAM,OAAO;IACb,KAAK,IAAI,CAAC;IACV,wGAAE,CAAC,aAAa,CAAC,eAAe,KAAK,SAAS,CAAC,MAAM,MAAM,IAAI;AACjE"}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":["file:///Users/ridmashehan/vinulab%20web/src/app/api/analytics/stats/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { getAnalytics } from \"@/lib/analytics\";\n\nexport async function GET(request: NextRequest) {\n  try {\n    const password = request.headers.get(\"x-admin-password\");\n    const expected = process.env.ADMIN_PASSWORD || \"vinulab-admin\";\n    if (password !== expected) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const visits = getAnalytics();\n\n    const uniqueIps = new Set(visits.map((v) => v.ip));\n    const byCountry: Record<string, number> = {};\n    const byPath: Record<string, number> = {};\n    const withLocation: { ll: [number, number]; country?: string; city?: string; count: number }[] = [];\n    const locationMap = new Map<string, { ll: [number, number]; country?: string; city?: string; count: number }>();\n\n    for (const v of visits) {\n      byPath[v.path] = (byPath[v.path] ?? 0) + 1;\n      if (v.country) byCountry[v.country] = (byCountry[v.country] ?? 0) + 1;\n\n      if (v.ll) {\n        const key = `${v.ll[0].toFixed(2)},${v.ll[1].toFixed(2)}`;\n        const existing = locationMap.get(key);\n        if (existing) existing.count++;\n        else locationMap.set(key, { ll: v.ll, country: v.country, city: v.city, count: 1 });\n      }\n    }\n\n    withLocation.push(...locationMap.values());\n\n    const last24h = Date.now() - 24 * 60 * 60 * 1000;\n    const last7d = Date.now() - 7 * 24 * 60 * 60 * 1000;\n    const visitsLast24h = visits.filter((v) => v.timestamp >= last24h).length;\n    const visitsLast7d = visits.filter((v) => v.timestamp >= last7d).length;\n\n    return NextResponse.json({\n      totalVisits: visits.length,\n      uniqueVisitors: uniqueIps.size,\n      visitsLast24h,\n      visitsLast7d,\n      byCountry: Object.entries(byCountry)\n        .sort((a, b) => b[1] - a[1])\n        .map(([country, count]) => ({ country, count })),\n      byPath: Object.entries(byPath)\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, 20),\n      locations: withLocation,\n      recentVisits: visits.slice(-100).reverse(),\n    });\n  } catch (err) {\n    console.error(\"Analytics stats error:\", err);\n    return NextResponse.json({ error: \"Failed to load analytics\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,WAAW,QAAQ,OAAO,CAAC,GAAG,CAAC;QACrC,MAAM,WAAW,QAAQ,GAAG,CAAC,cAAc,IAAI;QAC/C,IAAI,aAAa,UAAU;YACzB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,SAAS,IAAA,yIAAY;QAE3B,MAAM,YAAY,IAAI,IAAI,OAAO,GAAG,CAAC,CAAC,IAAM,EAAE,EAAE;QAChD,MAAM,YAAoC,CAAC;QAC3C,MAAM,SAAiC,CAAC;QACxC,MAAM,eAA2F,EAAE;QACnG,MAAM,cAAc,IAAI;QAExB,KAAK,MAAM,KAAK,OAAQ;YACtB,MAAM,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI;YACzC,IAAI,EAAE,OAAO,EAAE,SAAS,CAAC,EAAE,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,OAAO,CAAC,IAAI,CAAC,IAAI;YAEpE,IAAI,EAAE,EAAE,EAAE;gBACR,MAAM,MAAM,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI;gBACzD,MAAM,WAAW,YAAY,GAAG,CAAC;gBACjC,IAAI,UAAU,SAAS,KAAK;qBACvB,YAAY,GAAG,CAAC,KAAK;oBAAE,IAAI,EAAE,EAAE;oBAAE,SAAS,EAAE,OAAO;oBAAE,MAAM,EAAE,IAAI;oBAAE,OAAO;gBAAE;YACnF;QACF;QAEA,aAAa,IAAI,IAAI,YAAY,MAAM;QAEvC,MAAM,UAAU,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK;QAC5C,MAAM,SAAS,KAAK,GAAG,KAAK,IAAI,KAAK,KAAK,KAAK;QAC/C,MAAM,gBAAgB,OAAO,MAAM,CAAC,CAAC,IAAM,EAAE,SAAS,IAAI,SAAS,MAAM;QACzE,MAAM,eAAe,OAAO,MAAM,CAAC,CAAC,IAAM,EAAE,SAAS,IAAI,QAAQ,MAAM;QAEvE,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,aAAa,OAAO,MAAM;YAC1B,gBAAgB,UAAU,IAAI;YAC9B;YACA;YACA,WAAW,OAAO,OAAO,CAAC,WACvB,IAAI,CAAC,CAAC,GAAG,IAAM,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,EAC1B,GAAG,CAAC,CAAC,CAAC,SAAS,MAAM,GAAK,CAAC;oBAAE;oBAAS;gBAAM,CAAC;YAChD,QAAQ,OAAO,OAAO,CAAC,QACpB,IAAI,CAAC,CAAC,GAAG,IAAM,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,EAC1B,KAAK,CAAC,GAAG;YACZ,WAAW;YACX,cAAc,OAAO,KAAK,CAAC,CAAC,KAAK,OAAO;QAC1C;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAChF;AACF"}}]
}
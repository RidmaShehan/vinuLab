{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/ridmashehan/vinulab%20web/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL ?? \"\";\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY ?? \"\";\n\n/** Server-side Supabase client with service role (use in API routes / server code only). */\nexport function getSupabase() {\n  if (!supabaseUrl || !supabaseServiceKey) {\n    return null;\n  }\n  return createClient(supabaseUrl, supabaseServiceKey);\n}\n\nexport function hasSupabase(): boolean {\n  return Boolean(supabaseUrl && supabaseServiceKey);\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,wBAAwB,IAAI;AAC5D,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB,IAAI;AAG7D,SAAS;IACd,IAAI,CAAC,eAAe,CAAC,oBAAoB;QACvC,OAAO;IACT;IACA,OAAO,IAAA,gMAAY,EAAC,aAAa;AACnC;AAEO,SAAS;IACd,OAAO,QAAQ,eAAe;AAChC"}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///Users/ridmashehan/vinulab%20web/src/lib/analytics.ts"],"sourcesContent":["import path from \"path\";\nimport fs from \"fs\";\nimport { getSupabase } from \"./supabase\";\n\nexport interface VisitRecord {\n  id: string;\n  timestamp: number;\n  path: string;\n  ip: string;\n  country?: string;\n  region?: string;\n  city?: string;\n  ll?: [number, number];\n  userAgent?: string;\n  referrer?: string;\n  screenWidth?: number;\n  screenHeight?: number;\n}\n\nconst getFilePath = () => path.join(process.cwd(), \"src\", \"data\", \"analytics.json\");\n\nfunction readFromFile(): VisitRecord[] {\n  try {\n    const raw = fs.readFileSync(getFilePath(), \"utf-8\");\n    return JSON.parse(raw);\n  } catch {\n    return [];\n  }\n}\n\nfunction writeToFile(data: VisitRecord[]): void {\n  fs.writeFileSync(getFilePath(), JSON.stringify(data, null, 2), \"utf-8\");\n}\n\nexport async function getAnalytics(): Promise<VisitRecord[]> {\n  const supabase = getSupabase();\n  if (supabase) {\n    try {\n      const { data, error } = await supabase\n        .from(\"analytics_events\")\n        .select(\"id, timestamp, path, ip, country, region, city, ll, user_agent, referrer, screen_width, screen_height\")\n        .order(\"timestamp\", { ascending: false });\n      if (!error && Array.isArray(data)) {\n        return data.map((row) => ({\n          id: row.id,\n          timestamp: row.timestamp,\n          path: row.path ?? \"\",\n          ip: row.ip ?? \"\",\n          country: row.country ?? undefined,\n          region: row.region ?? undefined,\n          city: row.city ?? undefined,\n          ll: Array.isArray(row.ll) && row.ll.length >= 2 ? (row.ll as [number, number]) : undefined,\n          userAgent: row.user_agent ?? undefined,\n          referrer: row.referrer ?? undefined,\n          screenWidth: row.screen_width ?? undefined,\n          screenHeight: row.screen_height ?? undefined,\n        }));\n      }\n    } catch (e) {\n      console.warn(\"Supabase analytics fetch failed, using file:\", e);\n    }\n  }\n  return readFromFile();\n}\n\nexport async function appendVisit(record: VisitRecord): Promise<void> {\n  const supabase = getSupabase();\n  if (supabase) {\n    try {\n      const { error } = await supabase.from(\"analytics_events\").insert({\n        timestamp: record.timestamp,\n        path: record.path,\n        ip: record.ip,\n        country: record.country ?? null,\n        region: record.region ?? null,\n        city: record.city ?? null,\n        ll: record.ll ?? null,\n        user_agent: record.userAgent ?? null,\n        referrer: record.referrer ?? null,\n        screen_width: record.screenWidth ?? null,\n        screen_height: record.screenHeight ?? null,\n      });\n      if (!error) return;\n      throw new Error(error.message);\n    } catch (e) {\n      console.warn(\"Supabase analytics insert failed, using file:\", e);\n    }\n  }\n  const data = readFromFile();\n  data.push(record);\n  writeToFile(data);\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAiBA,MAAM,cAAc,IAAM,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,OAAO,QAAQ;AAElE,SAAS;IACP,IAAI;QACF,MAAM,MAAM,wGAAE,CAAC,YAAY,CAAC,eAAe;QAC3C,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,OAAO,EAAE;IACX;AACF;AAEA,SAAS,YAAY,IAAmB;IACtC,wGAAE,CAAC,aAAa,CAAC,eAAe,KAAK,SAAS,CAAC,MAAM,MAAM,IAAI;AACjE;AAEO,eAAe;IACpB,MAAM,WAAW,IAAA,uIAAW;IAC5B,IAAI,UAAU;QACZ,IAAI;YACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,oBACL,MAAM,CAAC,yGACP,KAAK,CAAC,aAAa;gBAAE,WAAW;YAAM;YACzC,IAAI,CAAC,SAAS,MAAM,OAAO,CAAC,OAAO;gBACjC,OAAO,KAAK,GAAG,CAAC,CAAC,MAAQ,CAAC;wBACxB,IAAI,IAAI,EAAE;wBACV,WAAW,IAAI,SAAS;wBACxB,MAAM,IAAI,IAAI,IAAI;wBAClB,IAAI,IAAI,EAAE,IAAI;wBACd,SAAS,IAAI,OAAO,IAAI;wBACxB,QAAQ,IAAI,MAAM,IAAI;wBACtB,MAAM,IAAI,IAAI,IAAI;wBAClB,IAAI,MAAM,OAAO,CAAC,IAAI,EAAE,KAAK,IAAI,EAAE,CAAC,MAAM,IAAI,IAAK,IAAI,EAAE,GAAwB;wBACjF,WAAW,IAAI,UAAU,IAAI;wBAC7B,UAAU,IAAI,QAAQ,IAAI;wBAC1B,aAAa,IAAI,YAAY,IAAI;wBACjC,cAAc,IAAI,aAAa,IAAI;oBACrC,CAAC;YACH;QACF,EAAE,OAAO,GAAG;YACV,QAAQ,IAAI,CAAC,gDAAgD;QAC/D;IACF;IACA,OAAO;AACT;AAEO,eAAe,YAAY,MAAmB;IACnD,MAAM,WAAW,IAAA,uIAAW;IAC5B,IAAI,UAAU;QACZ,IAAI;YACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,oBAAoB,MAAM,CAAC;gBAC/D,WAAW,OAAO,SAAS;gBAC3B,MAAM,OAAO,IAAI;gBACjB,IAAI,OAAO,EAAE;gBACb,SAAS,OAAO,OAAO,IAAI;gBAC3B,QAAQ,OAAO,MAAM,IAAI;gBACzB,MAAM,OAAO,IAAI,IAAI;gBACrB,IAAI,OAAO,EAAE,IAAI;gBACjB,YAAY,OAAO,SAAS,IAAI;gBAChC,UAAU,OAAO,QAAQ,IAAI;gBAC7B,cAAc,OAAO,WAAW,IAAI;gBACpC,eAAe,OAAO,YAAY,IAAI;YACxC;YACA,IAAI,CAAC,OAAO;YACZ,MAAM,IAAI,MAAM,MAAM,OAAO;QAC/B,EAAE,OAAO,GAAG;YACV,QAAQ,IAAI,CAAC,iDAAiD;QAChE;IACF;IACA,MAAM,OAAO;IACb,KAAK,IAAI,CAAC;IACV,YAAY;AACd"}},
    {"offset": {"line": 165, "column": 0}, "map": {"version":3,"sources":["file:///Users/ridmashehan/vinulab%20web/src/app/api/analytics/track/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { appendVisit, type VisitRecord } from \"@/lib/analytics\";\n\nfunction getClientIp(req: NextRequest): string {\n  const forwarded = req.headers.get(\"x-forwarded-for\");\n  if (forwarded) return forwarded.split(\",\")[0].trim();\n  const realIp = req.headers.get(\"x-real-ip\");\n  if (realIp) return realIp;\n  return \"127.0.0.1\";\n}\n\nasync function getGeo(ip: string): Promise<{ country?: string; region?: string; city?: string; ll?: [number, number] }> {\n  if (ip === \"127.0.0.1\" || ip === \"::1\" || ip.startsWith(\"192.168.\") || ip.startsWith(\"10.\")) {\n    return {};\n  }\n  try {\n    const res = await fetch(`http://ip-api.com/json/${ip}?fields=country,regionName,city,lat,lon`, {\n      signal: AbortSignal.timeout(3000),\n    });\n    const data = (await res.json()) as { country?: string; regionName?: string; city?: string; lat?: number; lon?: number };\n    if (data.lat != null && data.lon != null) {\n      return {\n        country: data.country,\n        region: data.regionName,\n        city: data.city,\n        ll: [data.lon, data.lat] as [number, number],\n      };\n    }\n  } catch {\n    // ignore\n  }\n  return {};\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const ip = getClientIp(request);\n    const body = await request.json().catch(() => ({}));\n    const { path: pagePath = \"/\", referrer, userAgent, screenWidth, screenHeight } = body;\n\n    const geo = await getGeo(ip);\n    const record: VisitRecord = {\n      id: `${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\n      timestamp: Date.now(),\n      path: String(pagePath).slice(0, 256),\n      ip,\n      country: geo.country,\n      region: geo.region,\n      city: geo.city,\n      ll: geo.ll,\n      userAgent: userAgent ? String(userAgent).slice(0, 512) : request.headers.get(\"user-agent\") ?? undefined,\n      referrer: referrer ? String(referrer).slice(0, 512) : undefined,\n      screenWidth: typeof screenWidth === \"number\" ? screenWidth : undefined,\n      screenHeight: typeof screenHeight === \"number\" ? screenHeight : undefined,\n    };\n\n    await appendVisit(record);\n    return NextResponse.json({ ok: true });\n  } catch (err) {\n    console.error(\"Analytics track error:\", err);\n    return NextResponse.json({ error: \"Track failed\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,SAAS,YAAY,GAAgB;IACnC,MAAM,YAAY,IAAI,OAAO,CAAC,GAAG,CAAC;IAClC,IAAI,WAAW,OAAO,UAAU,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI;IAClD,MAAM,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC;IAC/B,IAAI,QAAQ,OAAO;IACnB,OAAO;AACT;AAEA,eAAe,OAAO,EAAU;IAC9B,IAAI,OAAO,eAAe,OAAO,SAAS,GAAG,UAAU,CAAC,eAAe,GAAG,UAAU,CAAC,QAAQ;QAC3F,OAAO,CAAC;IACV;IACA,IAAI;QACF,MAAM,MAAM,MAAM,MAAM,CAAC,uBAAuB,EAAE,GAAG,uCAAuC,CAAC,EAAE;YAC7F,QAAQ,YAAY,OAAO,CAAC;QAC9B;QACA,MAAM,OAAQ,MAAM,IAAI,IAAI;QAC5B,IAAI,KAAK,GAAG,IAAI,QAAQ,KAAK,GAAG,IAAI,MAAM;YACxC,OAAO;gBACL,SAAS,KAAK,OAAO;gBACrB,QAAQ,KAAK,UAAU;gBACvB,MAAM,KAAK,IAAI;gBACf,IAAI;oBAAC,KAAK,GAAG;oBAAE,KAAK,GAAG;iBAAC;YAC1B;QACF;IACF,EAAE,OAAM;IACN,SAAS;IACX;IACA,OAAO,CAAC;AACV;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,KAAK,YAAY;QACvB,MAAM,OAAO,MAAM,QAAQ,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QACjD,MAAM,EAAE,MAAM,WAAW,GAAG,EAAE,QAAQ,EAAE,SAAS,EAAE,WAAW,EAAE,YAAY,EAAE,GAAG;QAEjF,MAAM,MAAM,MAAM,OAAO;QACzB,MAAM,SAAsB;YAC1B,IAAI,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,IAAI;YAC7D,WAAW,KAAK,GAAG;YACnB,MAAM,OAAO,UAAU,KAAK,CAAC,GAAG;YAChC;YACA,SAAS,IAAI,OAAO;YACpB,QAAQ,IAAI,MAAM;YAClB,MAAM,IAAI,IAAI;YACd,IAAI,IAAI,EAAE;YACV,WAAW,YAAY,OAAO,WAAW,KAAK,CAAC,GAAG,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,iBAAiB;YAC9F,UAAU,WAAW,OAAO,UAAU,KAAK,CAAC,GAAG,OAAO;YACtD,aAAa,OAAO,gBAAgB,WAAW,cAAc;YAC7D,cAAc,OAAO,iBAAiB,WAAW,eAAe;QAClE;QAEA,MAAM,IAAA,wIAAW,EAAC;QAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;QAAK;IACtC,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF"}}]
}